
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The InvestSuite Integration API is the one-stop shop for integrations with InvestSuite's range of invest-tech solutions. These pages provide technical documentation to assist developers working with our APIs.">
      
      
        <meta name="author" content="InvestSuite">
      
      
        <link rel="canonical" href="https://docs.investsuite.com/scenarios/cash_movements/">
      
      <link rel="icon" href="../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.7">
    
    
      
        <title>Funding and withdrawal - InvestSuite Integration API documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    




<meta property="og:type" content="website">
<meta property="og:title" content="InvestSuite Integration API documentation - Funding & withdrawal (process)">
<meta property="og:description" content="The InvestSuite Integration API is the one-stop shop for integrations with InvestSuite's range of invest-tech solutions. These pages provide technical documentation to assist developers working with our APIs.">
<meta property="og:url" content="https://docs.investsuite.com/scenarios/cash_movements/">
<link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.13.0/css/all.css">

  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="investsuite" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#funding" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="InvestSuite Integration API documentation" class="md-header__button md-logo" aria-label="InvestSuite Integration API documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            InvestSuite Integration API documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Funding and withdrawal
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/investsuite/investsuite-api-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>
  </div>
  <div class="md-source__repository">
    View/Edit on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        Concepts
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../onboarding/" class="md-tabs__link md-tabs__link--active">
        Scenarios
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../robo/introduction/" class="md-tabs__link">
        Robo Advisor
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../self/introduction/" class="md-tabs__link">
        Self Investor
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../insight-apis/introduction/" class="md-tabs__link">
        Insight APIs
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="https://api.sandbox.investsuite.com/redoc" class="md-tabs__link">
      Integration OpenAPI
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="https://api.data.investsuite.com/redoc" class="md-tabs__link">
      Insight APIs OpenAPI
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../changelog/" class="md-tabs__link">
      Release notes
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="InvestSuite Integration API documentation" class="md-nav__button md-logo" aria-label="InvestSuite Integration API documentation" data-md-component="logo">
      
  <img src="../../assets/logo.png" alt="logo">

    </a>
    InvestSuite Integration API documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/investsuite/investsuite-api-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M96 0C43 0 0 43 0 96v320c0 53 43 96 96 96h320c17.7 0 32-14.3 32-32s-14.3-32-32-32v-64c17.7 0 32-14.3 32-32V32c0-17.7-14.3-32-32-32H96zm0 384h256v64H96c-17.7 0-32-14.3-32-32s14.3-32 32-32zm32-240c0-8.8 7.2-16 16-16h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16zm16 48h192c8.8 0 16 7.2 16 16s-7.2 16-16 16H144c-8.8 0-16-7.2-16-16s7.2-16 16-16z"/></svg>
  </div>
  <div class="md-source__repository">
    View/Edit on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Concepts
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Concepts" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/architecture.md" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/authentication/" class="md-nav__link">
        Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/events/" class="md-nav__link">
        Events
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/embedding/" class="md-nav__link">
        Embedding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/errors/" class="md-nav__link">
        API errors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/entities/" class="md-nav__link">
        Business objects
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/users/" class="md-nav__link">
        User (object)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/portfolios/" class="md-nav__link">
        Portfolio (object)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/transactions/" class="md-nav__link">
        Transaction (object)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Scenarios
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Scenarios" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Scenarios
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../onboarding/" class="md-nav__link">
        Onboarding (process)
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Funding & withdrawal (process)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Funding & withdrawal (process)
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#funding" class="md-nav__link">
    Funding
  </a>
  
    <nav class="md-nav" aria-label="Funding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#broker-integration-by-investsuite" class="md-nav__link">
    Broker integration by InvestSuite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broker-integration-by-the-client" class="md-nav__link">
    Broker integration by the Client
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#withdrawal" class="md-nav__link">
    Withdrawal
  </a>
  
    <nav class="md-nav" aria-label="Withdrawal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#robo-advisor" class="md-nav__link">
    Robo Advisor
  </a>
  
    <nav class="md-nav" aria-label="Robo Advisor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#broker-integration-by-investsuite_1" class="md-nav__link">
    Broker integration by InvestSuite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broker-integration-by-the-client-event-driven" class="md-nav__link">
    Broker integration by the Client (Event driven)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broker-integration-by-the-client-batch-process" class="md-nav__link">
    Broker integration by the Client (Batch process)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#self-investor" class="md-nav__link">
    Self Investor
  </a>
  
    <nav class="md-nav" aria-label="Self Investor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#broker-integration-by-investsuite_2" class="md-nav__link">
    Broker integration by InvestSuite
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../suitability_profiler/" class="md-nav__link">
        Suitability profiler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../thematic_search/" class="md-nav__link">
        Thematic search
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Robo Advisor
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Robo Advisor" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Robo Advisor
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../robo/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../robo/quick_start/" class="md-nav__link">
        Quick start
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../robo/run_optimizer/" class="md-nav__link">
        Optimize a portfolio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../robo/rebalancing/" class="md-nav__link">
        Rebalancing (process)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../robo/optimization/" class="md-nav__link">
        Optimization (object)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Self Investor
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Self Investor" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Self Investor
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../self/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Insight APIs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Insight APIs" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Insight APIs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../insight-apis/introduction/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../insight-apis/authentication_usage/" class="md-nav__link">
        Authentication & Usage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../insight-apis/custom_data/" class="md-nav__link">
        Custom Data API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../insight-apis/xray/" class="md-nav__link">
        X-Ray API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../insight-apis/idcard/" class="md-nav__link">
        ID Card API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../insight-apis/themes/" class="md-nav__link">
        Themes API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../insight-apis/inspiration/" class="md-nav__link">
        Inspiration API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../insight-apis/logos/" class="md-nav__link">
        Logos API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../insight-apis/monte_carlo/" class="md-nav__link">
        Monte Carlo API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../insight-apis/reference/" class="md-nav__link">
        Reference API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../insight-apis/tenant_config/" class="md-nav__link">
        Tenant Configuration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://api.sandbox.investsuite.com/redoc" class="md-nav__link">
        Integration OpenAPI
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://api.data.investsuite.com/redoc" class="md-nav__link">
        Insight APIs OpenAPI
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        Release notes
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#funding" class="md-nav__link">
    Funding
  </a>
  
    <nav class="md-nav" aria-label="Funding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#broker-integration-by-investsuite" class="md-nav__link">
    Broker integration by InvestSuite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broker-integration-by-the-client" class="md-nav__link">
    Broker integration by the Client
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#withdrawal" class="md-nav__link">
    Withdrawal
  </a>
  
    <nav class="md-nav" aria-label="Withdrawal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#robo-advisor" class="md-nav__link">
    Robo Advisor
  </a>
  
    <nav class="md-nav" aria-label="Robo Advisor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#broker-integration-by-investsuite_1" class="md-nav__link">
    Broker integration by InvestSuite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broker-integration-by-the-client-event-driven" class="md-nav__link">
    Broker integration by the Client (Event driven)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#broker-integration-by-the-client-batch-process" class="md-nav__link">
    Broker integration by the Client (Batch process)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#self-investor" class="md-nav__link">
    Self Investor
  </a>
  
    <nav class="md-nav" aria-label="Self Investor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#broker-integration-by-investsuite_2" class="md-nav__link">
    Broker integration by InvestSuite
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
    <h1>Funding and withdrawal</h1>
    <div class="md-source-date">
    <small>
        <hr style="margin:0.5rem 0rem;">
        
    </small>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/timeago.js/4.0.2/timeago.min.js"></script>
<script>timeago.render(document.querySelectorAll('.timeago'));</script>
<p>There are two sorts of cash transactions: deposits (funding) and withdrawals. Depending on (1) the direction (fund, withdraw) (2) the setup with the broker (who is integrated: the Client or InvestSuite), and (3) the product (Robo Advisor or Self Investor) the Client Middleware performs several actions. These actions range from moving the money in the broker's account system, to making InvestSuite send a notification. Below we describe in detail which actions to take, and which ones InvestSuite takes depending on the scenario.</p>
<p>For <strong>Robo Advisor</strong>, the Funding/Withdrawal process and the <a href="../../robo/rebalancing/">Rebalancing process</a> are closely related:</p>
<ul>
<li>A <em>funding</em> triggers Optimizer, which will generate an Optimization, which contains orders that (during rebalancing) will <em>invest the cash</em>;</li>
<li>A <em>withdrawal</em> triggers Optimizer, which will generate an Optimization, which contains orders that (during rebalancing) will <em>divest instruments and free up cash</em>.</li>
</ul>
<p>If you are looking to design/build a middleware that handles both, we recommend to have a look at our <a href="middleware.md">example middleware design</a>.</p>
<p>For <strong>Self Investor</strong>, the Funding/Withdrawal process is more straightforward, as the Customer is responsible for investing/freeing up cash.</p>
<h2 id="funding">Funding<a class="headerlink" href="#funding" title="Permanent link">&para;</a></h2>
<h3 id="broker-integration-by-investsuite">Broker integration by InvestSuite<a class="headerlink" href="#broker-integration-by-investsuite" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Applies to Robo Advisor, Self Investor</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>We assume there is an integration between the Broker/Custodian and the Core Banking System (eg. through end-of-day files), that handles the corresponding cash transfers.</p>
</div>
<ol>
<li>The <strong>Client Middleware</strong> notifies InvestSuite that the investor account at the Bank has been funded by calling <code>POST /events/deposit/</code> (see <a href="../../concepts/events/#deposit-event">here</a>).</li>
<li><strong>InvestSuite</strong> moves the cash at the broker from the bank's home account to the customer's subaccount. InvestSuite will manage keeping the Transactions, Portfolio Holdings up to date (asynchronously).</li>
<li>If this is the first funding, <strong>InvestSuite</strong> sets the <code>funded_since</code> field.</li>
<li>In case of Robo Advisor, this will (asynchronously) trigger Optimizer.</li>
<li><strong>InvestSuite</strong> sends a notification to the Customer.</li>
</ol>
<h3 id="broker-integration-by-the-client">Broker integration by the Client<a class="headerlink" href="#broker-integration-by-the-client" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Applies to Robo Advisor</p>
</div>
<ol>
<li>The <strong>Client Middleware</strong> moves the cash at the broker from the bank's home account to the individual's subaccount.</li>
<li>Optionally, the <strong>Client Middleware</strong> creates an <code>EXECUTED</code> Transaction in InvestSuite, referring to the <code>transaction_id</code> of the broker in the <code>external_id</code> field (see <a href="../../concepts/transactions/#funding">here</a>).</li>
<li>Once the Transaction is settled at the broker, the <strong>Client Middleware</strong> updates the Transaction status to <code>SETTLED</code> (see <a href="../../concepts/transactions/#order-settled">here</a>).</li>
<li>The <strong>Client Middleware</strong> updates the portfolio's cash position (see <a href="../../concepts/portfolios/#holdings">here</a>). Depending on how the master system (eg. PMS) reflects positions, execute this step earlier in the process (eg. after creating the <code>EXECUTED</code> Transaction).</li>
<li>In case of Robo Advisor, this will (asynchronously) trigger Optimizer.</li>
<li>If the Portfolio was not yet marked as funded, the <strong>Client Middleware</strong> also sets <code>funded_since</code> field (see <a href="../../concepts/portfolios/#funded-status">here</a>).</li>
<li>The <strong>Client Middleware</strong> calls <code>POST /events/deposit/</code> (see <a href="../../concepts/events/#funding-deposit-event">here</a>).</li>
<li><strong>InvestSuite</strong> sends a notification to the Customer.</li>
</ol>
<p><svg contentStyleType="text/css" preserveAspectRatio="none" style="background:#F9F9F9" version="1.1" viewBox="0 0 953 817" width="100%" zoomAndPan="magnify" class="class1,class2" alt="uml diagram" title=""><defs /><g><rect fill="none" height="120.7969" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="470.5" x="97.5" y="245.0938" /><rect fill="none" height="59.2656" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="318.5" x="97.5" y="512.5547" /><rect fill="none" height="46.2656" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="470.5" x="97.5" y="614.9531" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="43" x2="43" y1="81.2969" y2="736.4844" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="154.5" x2="154.5" y1="81.2969" y2="736.4844" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="487" x2="487" y1="81.2969" y2="736.4844" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="699.5" x2="699.5" y1="81.2969" y2="736.4844" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="863.5" x2="863.5" y1="81.2969" y2="736.4844" /><text fill="#191919" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="5" y="77.9951">Customer</text><ellipse cx="43" cy="13.5" fill="#191919" rx="8" ry="8" style="stroke:#191919;stroke-width:0.5;" /><path d="M43,21.5 L43,48.5 M30,29.5 L56,29.5 M43,48.5 L30,63.5 M43,48.5 L56,63.5 " fill="none" style="stroke:#191919;stroke-width:0.5;" /><text fill="#191919" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="5" y="748.4795">Customer</text><ellipse cx="43" cy="760.2813" fill="#191919" rx="8" ry="8" style="stroke:#191919;stroke-width:0.5;" /><path d="M43,768.2813 L43,795.2813 M30,776.2813 L56,776.2813 M43,795.2813 L30,810.2813 M43,795.2813 L56,810.2813 " fill="none" style="stroke:#191919;stroke-width:0.5;" /><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="95" x="107.5" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="114.5" y="69.9951">InvestSuite</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="95" x="107.5" y="735.4844" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="114.5" y="755.4795">InvestSuite</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="142" x="416" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="423" y="69.9951">Client Middleware</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="142" x="416" y="735.4844" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="423" y="755.4795">Client Middleware</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="139" x="630.5" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="637.5" y="69.9951">Broker/Custodian</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="139" x="630.5" y="735.4844" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="637.5" y="755.4795">Broker/Custodian</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="168" x="779.5" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="786.5" y="69.9951">Core Banking System</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="168" x="779.5" y="735.4844" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="786.5" y="755.4795">Core Banking System</text><polygon fill="#191919" points="851.5,108.4297,861.5,112.4297,851.5,116.4297,855.5,112.4297" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="43" x2="857.5" y1="112.4297" y2="112.4297" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="236" x="50" y="107.3638">Customer funds his investor account</text><polygon fill="#191919" points="498,137.5625,488,141.5625,498,145.5625,494,141.5625" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="492" x2="862.5" y1="141.5625" y2="141.5625" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="504" y="136.4966">Funding event</text><polygon fill="#191919" points="688,196.9609,698,200.9609,688,204.9609,692,200.9609" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="487" x2="694" y1="200.9609" y2="200.9609" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="494" y="165.6294">1. Move cash</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="494" y="180.7622">from bank's home account to</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="494" y="195.895">customer's subaccount</text><polygon fill="#191919" points="498,226.0938,488,230.0938,498,234.0938,494,230.0938" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="492" x2="699" y1="230.0938" y2="230.0938" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="71" x="504" y="225.0278">external_id</text><path d="M101,245.0938 L169.5,245.0938 L169.5,252.2266 L159.5,262.2266 L97.5,262.2266 L97.5,248.5938 A3.5,3.5 0 0 1 101,245.0938 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="120.7969" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="470.5" x="97.5" y="245.0938" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="112.5" y="258.1606">opt</text><polygon fill="#191919" points="166,324.7578,156,328.7578,166,332.7578,162,328.7578" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="160" x2="486" y1="328.7578" y2="328.7578" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="172" y="278.2935">2. POST /portfolio/{id}/transactions/ with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="172" y="293.4263">- type: CASH_DEPOSIT</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="172" y="308.5591">- status: EXECUTED</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="172" y="323.6919">- external_id</text><polygon fill="#191919" points="475,353.8906,485,357.8906,475,361.8906,479,357.8906" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="155" x2="481" y1="357.8906" y2="357.8906" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="162" y="352.8247">response</text><polygon fill="#191919" points="497.9811,390.9765,488,395.0234,498.0187,398.9764,493.9999,394.9953" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="699" x2="487" y1="394.0234" y2="395.0234" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="504" y="388.9575">Transaction SETTLED</text><polygon fill="#191919" points="166,435.2891,156,439.2891,166,443.2891,162,439.2891" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="160" x2="486" y1="439.2891" y2="439.2891" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304" x="172" y="419.0903">3. PATCH /portfolio/{id}/transactions/{id}/ with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="172" y="434.2231">- status: SETTLED</text><polygon fill="#191919" points="475,464.4219,485,468.4219,475,472.4219,479,468.4219" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="155" x2="481" y1="468.4219" y2="468.4219" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="162" y="463.356">response</text><polygon fill="#191919" points="166,493.5547,156,497.5547,166,501.5547,162,497.5547" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="160" x2="486" y1="497.5547" y2="497.5547" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="172" y="492.4888">4. PATCH /portfolio Holdings</text><path d="M101,512.5547 L169.5,512.5547 L169.5,519.6875 L159.5,529.6875 L97.5,529.6875 L97.5,516.0547 A3.5,3.5 0 0 1 101,512.5547 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="59.2656" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="318.5" x="97.5" y="512.5547" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="112.5" y="525.6216">opt</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="113" x="184.5" y="524.7651">[if Robo Advisor]</text><line style="stroke:#191919;stroke-width:1.0;" x1="155" x2="197" y1="550.8203" y2="550.8203" /><line style="stroke:#191919;stroke-width:1.0;" x1="197" x2="197" y1="550.8203" y2="563.8203" /><line style="stroke:#191919;stroke-width:1.0;" x1="156" x2="197" y1="563.8203" y2="563.8203" /><polygon fill="#191919" points="166,559.8203,156,563.8203,166,567.8203,162,563.8203" style="stroke:#191919;stroke-width:1.0;" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="162" y="545.7544">5. Trigger Optimizer (asynchronously)</text><polygon fill="#191919" points="475,595.9531,485,599.9531,475,603.9531,479,599.9531" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="155" x2="481" y1="599.9531" y2="599.9531" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="162" y="594.8872">response</text><path d="M101,614.9531 L169.5,614.9531 L169.5,622.0859 L159.5,632.0859 L97.5,632.0859 L97.5,618.4531 A3.5,3.5 0 0 1 101,614.9531 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="46.2656" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="470.5" x="97.5" y="614.9531" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="112.5" y="628.02">opt</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="227" x="184.5" y="627.1636">[if response.funded_since == null]</text><polygon fill="#191919" points="166,649.2188,156,653.2188,166,657.2188,162,653.2188" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="160" x2="486" y1="653.2188" y2="653.2188" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="172" y="648.1528">6. PATCH /portfolio funded_since</text><polygon fill="#191919" points="166,685.3516,156,689.3516,166,693.3516,162,689.3516" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="160" x2="486" y1="689.3516" y2="689.3516" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="153" x="172" y="684.2856">7. POST /events/deposit</text><polygon fill="#191919" points="54,714.4844,44,718.4844,54,722.4844,50,718.4844" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="48" x2="154" y1="718.4844" y2="718.4844" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="60" y="713.4185">8. Notification</text></g></svg></p>
<h2 id="withdrawal">Withdrawal<a class="headerlink" href="#withdrawal" title="Permanent link">&para;</a></h2>
<h3 id="robo-advisor">Robo Advisor<a class="headerlink" href="#robo-advisor" title="Permanent link">&para;</a></h3>
<h4 id="broker-integration-by-investsuite_1">Broker integration by InvestSuite<a class="headerlink" href="#broker-integration-by-investsuite_1" title="Permanent link">&para;</a></h4>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>We assume there is an integration between the Broker/Custodian and the Core Banking System (eg. through end-of-day files), which is master of the <code>counter_account</code> and handles the corresponding cash transfers.</p>
</div>
<ol>
<li>A withdrawal is triggered:<ol>
<li>Either by the <strong>Customer</strong>, through the InvestSuite app. The app sets the <code>divest_amount</code> on the Portfolio object.</li>
<li>Either by the <strong>Client Middleware</strong>, by setting the <code>divest_amount</code> on the Portfolio (see <a href="../../concepts/portfolios/#set-divest-amount">here</a>).</li>
</ol>
</li>
<li><strong>InvestSuite</strong> asynchronously runs Optimizer, resulting in an Optimization which, during the next rebalancing, will free up cash.</li>
<li>In case of an advisory mandate the <strong>Customer</strong> confirms the Optimizaton. The confirmation is registered in the <code>owner_choice</code> field of the Optimization object.</li>
<li>If there is sufficient cash in the Portfolio:<ol>
<li><strong>InvestSuite</strong> moves the cash at the broker from the customer's subaccount to the bank's home account. InvestSuite will manage keeping the Transactions, Portfolio Holdings and the <code>divest_amount</code> up to date (asynchronously). </li>
<li>The <strong>Core Banking System</strong> transfers the cash to the customer's <code>counter_account</code>.</li>
<li>The <strong>Client Middleware</strong> notifies InvestSuite that the payment has occurred (see <a href="../../concepts/events/#withdrawal-executed-event">here</a>).</li>
<li><strong>InvestSuite</strong> sends a notification to the Customer.</li>
</ol>
</li>
<li>If not, the withdrawal will be handled by the <strong>Client Middleware</strong> at a later time, by the rebalancing process or the process that handles executed or settled transactions from the broker. See the <a href="todo.md">Example Middleware Design</a>.</li>
</ol>
<p><svg contentStyleType="text/css" preserveAspectRatio="none" style="background:#F9F9F9" version="1.1" viewBox="0 0 1168 790" width="100%" zoomAndPan="magnify" class="class1,class2" alt="uml diagram" title=""><defs /><g><rect fill="none" height="90.2031" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="561" x="10" y="98.2969" /><rect fill="none" height="46.2656" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="382" x="10" y="244.6328" /><rect fill="none" height="358.3984" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="1151" x="10" y="334.0313" /><rect fill="none" height="132.6641" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="742" x="409" y="387.2969" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="58" x2="58" y1="81.2969" y2="709.4297" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="233.5" x2="233.5" y1="81.2969" y2="709.4297" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="490" x2="490" y1="81.2969" y2="709.4297" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="695.5" x2="695.5" y1="81.2969" y2="709.4297" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="909" x2="909" y1="81.2969" y2="709.4297" /><text fill="#191919" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="20" y="77.9951">Customer</text><ellipse cx="58" cy="13.5" fill="#191919" rx="8" ry="8" style="stroke:#191919;stroke-width:0.5;" /><path d="M58,21.5 L58,48.5 M45,29.5 L71,29.5 M58,48.5 L45,63.5 M58,48.5 L71,63.5 " fill="none" style="stroke:#191919;stroke-width:0.5;" /><text fill="#191919" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="20" y="721.4248">Customer</text><ellipse cx="58" cy="733.2266" fill="#191919" rx="8" ry="8" style="stroke:#191919;stroke-width:0.5;" /><path d="M58,741.2266 L58,768.2266 M45,749.2266 L71,749.2266 M58,768.2266 L45,783.2266 M58,768.2266 L71,783.2266 " fill="none" style="stroke:#191919;stroke-width:0.5;" /><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="95" x="186.5" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="193.5" y="69.9951">InvestSuite</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="95" x="186.5" y="708.4297" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="193.5" y="728.4248">InvestSuite</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="142" x="419" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="426" y="69.9951">Client Middleware</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="142" x="419" y="708.4297" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="426" y="728.4248">Client Middleware</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="139" x="626.5" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="633.5" y="69.9951">Broker/Custodian</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="139" x="626.5" y="708.4297" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="633.5" y="728.4248">Broker/Custodian</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="168" x="825" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="832" y="69.9951">Core Banking System</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="168" x="825" y="708.4297" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="832" y="728.4248">Core Banking System</text><path d="M13.5,98.2969 L76,98.2969 L76,105.4297 L66,115.4297 L10,115.4297 L10,101.7969 A3.5,3.5 0 0 1 13.5,98.2969 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="90.2031" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="561" x="10" y="98.2969" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="25" y="111.3638">alt</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="115" x="91" y="110.5073">[InvestSuite App]</text><polygon fill="#191919" points="222,132.5625,232,136.5625,222,140.5625,226,136.5625" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="58" x2="228" y1="136.5625" y2="136.5625" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="65" y="131.4966">1a. Request withdrawal</text><line style="stroke:#393939;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="571" y1="145.5625" y2="145.5625" /><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="85" x="15" y="155.7729">[Middleware]</text><polygon fill="#191919" points="245,176.5,235,180.5,245,184.5,241,180.5" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="239" x2="489" y1="180.5" y2="180.5" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="251" y="175.4341">1b. Request withdrawal</text><line style="stroke:#191919;stroke-width:1.0;" x1="234" x2="276" y1="216.6328" y2="216.6328" /><line style="stroke:#191919;stroke-width:1.0;" x1="276" x2="276" y1="216.6328" y2="229.6328" /><line style="stroke:#191919;stroke-width:1.0;" x1="235" x2="276" y1="229.6328" y2="229.6328" /><polygon fill="#191919" points="245,225.6328,235,229.6328,245,233.6328,241,229.6328" style="stroke:#191919;stroke-width:1.0;" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="241" y="211.5669">2. Trigger Optimizer (asynchronously)</text><path d="M13.5,244.6328 L82,244.6328 L82,251.7656 L72,261.7656 L10,261.7656 L10,248.1328 A3.5,3.5 0 0 1 13.5,244.6328 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="46.2656" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="382" x="10" y="244.6328" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="25" y="257.6997">opt</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="290" x="97" y="256.8433">[if Advisory mandate and insufficient cash]</text><polygon fill="#191919" points="222,278.8984,232,282.8984,222,286.8984,226,282.8984" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="58" x2="228" y1="282.8984" y2="282.8984" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="65" y="277.8325">3. Confirm Optimization</text><polygon fill="#191919" points="684,315.0313,694,319.0313,684,323.0313,688,319.0313" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="234" x2="690" y1="319.0313" y2="319.0313" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="241" y="313.9653">4. Get available cash in Portfolio</text><path d="M13.5,334.0313 L76,334.0313 L76,341.1641 L66,351.1641 L10,351.1641 L10,337.5313 A3.5,3.5 0 0 1 13.5,334.0313 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="358.3984" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="1151" x="10" y="334.0313" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="25" y="347.0981">alt</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="292" x="91" y="346.2417">[Sufficient Cash (divest_amount &lt;= cash&gt;)]</text><polygon fill="#191919" points="684,368.2969,694,372.2969,684,376.2969,688,372.2969" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="234" x2="690" y1="372.2969" y2="372.2969" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="438" x="241" y="367.231">5a. Move cash from customer's subaccount to bank's home account</text><path d="M412.5,387.2969 L481,387.2969 L481,394.4297 L471,404.4297 L409,404.4297 L409,390.7969 A3.5,3.5 0 0 1 412.5,387.2969 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="132.6641" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="742" x="409" y="387.2969" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="424" y="400.3638">opt</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="418" x="496" y="399.5073">[This depends on how the Bank and the Broker are integrated]</text><polygon fill="#191919" points="897,421.5625,907,425.5625,897,429.5625,901,425.5625" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="696" x2="903" y1="425.5625" y2="425.5625" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189" x="703" y="420.4966">Respond to cash movements</text><line style="stroke:#191919;stroke-width:1.0;" x1="909" x2="951" y1="469.8281" y2="469.8281" /><line style="stroke:#191919;stroke-width:1.0;" x1="951" x2="951" y1="469.8281" y2="482.8281" /><line style="stroke:#191919;stroke-width:1.0;" x1="910" x2="951" y1="482.8281" y2="482.8281" /><polygon fill="#191919" points="920,478.8281,910,482.8281,920,486.8281,916,482.8281" style="stroke:#191919;stroke-width:1.0;" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="916" y="449.6294">5b. Execute cash transfer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="916" y="464.7622">to the Customer's counter account</text><polygon fill="#191919" points="501,507.9609,491,511.9609,501,515.9609,497,511.9609" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="495" x2="908" y1="511.9609" y2="511.9609" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="507" y="506.895">Cash transfer EXECUTED</text><polygon fill="#191919" points="245,544.0938,235,548.0938,245,552.0938,241,548.0938" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="239" x2="489" y1="548.0938" y2="548.0938" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="172" x="251" y="543.0278">5c. POST /events/withdraw</text><polygon fill="#191919" points="69,573.2266,59,577.2266,69,581.2266,65,577.2266" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="63" x2="233" y1="577.2266" y2="577.2266" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="75" y="572.1606">5d. Notification</text><line style="stroke:#393939;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="1161" y1="586.2266" y2="586.2266" /><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="125" x="15" y="596.437">[Insufficient Cash]</text><line style="stroke:#191919;stroke-width:1.0;" x1="490" x2="532" y1="606.0313" y2="606.0313" /><line style="stroke:#191919;stroke-width:1.0;" x1="532" x2="532" y1="606.0313" y2="619.0313" /><line style="stroke:#191919;stroke-width:1.0;" x1="491" x2="532" y1="619.0313" y2="619.0313" /><polygon fill="#191919" points="501,615.0313,491,619.0313,501,623.0313,497,619.0313" style="stroke:#191919;stroke-width:1.0;" /><path d="M495,635.5313 L495,683.5313 A3.5,3.5 0 0 0 498.5,687.0313 L883.5,687.0313 A3.5,3.5 0 0 0 887,683.5313 L887,642.0313 L877,632.0313 L498.5,632.0313 A3.5,3.5 0 0 0 495,635.5313 " fill="#E5E5E5" style="stroke:#181818;stroke-width:1.5;" /><path d="M877,632.0313 L877,640.2813 A1.75,1.75 0 0 0 878.75,642.0313 L887,642.0313 L877,632.0313 " fill="#E5E5E5" style="stroke:#181818;stroke-width:1.5;" /><text fill="#191919" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="501" y="649.0981">6. The withdrawal will be handled at a later time,</text><text fill="#191919" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299" x="501" y="664.231">by the rebalancing process or the process that</text><text fill="#191919" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="371" x="501" y="679.3638">handles executed or settled transactions from the broker.</text></g></svg></p>
<h4 id="broker-integration-by-the-client-event-driven">Broker integration by the Client (Event driven)<a class="headerlink" href="#broker-integration-by-the-client-event-driven" title="Permanent link">&para;</a></h4>
<ol>
<li>A withdrawal is triggered:<ol>
<li>Either by the <strong>Customer</strong>, through the InvestSuite app. The app sets the <code>divest_amount</code> on the Portfolio object.</li>
<li>Either by the <strong>Client Middleware</strong>, by setting the <code>divest_amount</code> on the Portfolio (see <a href="../../concepts/portfolios/#set-divest-amount">here</a>).</li>
</ol>
</li>
<li><strong>InvestSuite</strong> asynchronously runs Optimizer, resulting in an Optimization which, during the next rebalancing, will free up cash.</li>
<li>In case of an advisory mandate and insufficient cash, the <strong>Customer</strong> confirms the Optimization. The confirmation is registered in the <code>owner_choice</code> field of the Optimization object.</li>
<li>The <code>portfolio.withdrawal-request</code> event is fired (see <a href="../../concepts/events/#withdrawal-request">here</a>).</li>
<li>If there is sufficient cash in the Portfolio (get this from the Core Banking System or from the Portfolio object):<ol>
<li>The <strong>Client Middleware</strong> instructs the <strong>Core Banking System</strong> to execute the cash transfer.</li>
<li>The <strong>Client Middleware</strong> creates a Transaction, type CASH, status SETTLED, and a negative quantity (see <a href="../../concepts/transactions/#withdrawal">here</a>).</li>
<li>The <strong>Client Middleware</strong> sets the <code>divest_amount</code> to 0, indicating there is no more cash to divest (see <a href="../../concepts/portfolios/#set-divest-amount">here</a>).</li>
<li>The <strong>Client Middleware</strong> updates the Portfolio Holdings with decreased cash (see <a href="../../concepts/portfolios/#holdings">here</a>).</li>
<li>The <strong>Client Middleware</strong> informs InvestSuite that the withdrawal has executed by calling <code>POST /events/withdraw/</code> (see <a href="../../concepts/events/#withdrawal-executed-event">here</a>).</li>
<li><strong>InvestSuite</strong> sends a notification to the Customer.</li>
</ol>
</li>
<li>If not, the withdrawal will be handled by the <strong>Client Middleware</strong> at a later time, by the rebalancing process or the process that handles executed or settled transactions from the broker. See the <a href="todo.md">Example Middleware Design</a>.</li>
</ol>
<p><svg contentStyleType="text/css" preserveAspectRatio="none" style="background:#F9F9F9" version="1.1" viewBox="0 0 977 896" width="100%" zoomAndPan="magnify" class="class1,class2" alt="uml diagram" title=""><defs /><g><rect fill="none" height="90.2031" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="633" x="10" y="98.2969" /><rect fill="none" height="46.2656" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="382" x="10" y="244.6328" /><rect fill="none" height="405.0625" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="960" x="10" y="393.4297" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="58" x2="58" y1="81.2969" y2="815.4922" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="233.5" x2="233.5" y1="81.2969" y2="815.4922" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="562" x2="562" y1="81.2969" y2="815.4922" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="712" x2="712" y1="81.2969" y2="815.4922" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="876" x2="876" y1="81.2969" y2="815.4922" /><text fill="#191919" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="20" y="77.9951">Customer</text><ellipse cx="58" cy="13.5" fill="#191919" rx="8" ry="8" style="stroke:#191919;stroke-width:0.5;" /><path d="M58,21.5 L58,48.5 M45,29.5 L71,29.5 M58,48.5 L45,63.5 M58,48.5 L71,63.5 " fill="none" style="stroke:#191919;stroke-width:0.5;" /><text fill="#191919" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="20" y="827.4873">Customer</text><ellipse cx="58" cy="839.2891" fill="#191919" rx="8" ry="8" style="stroke:#191919;stroke-width:0.5;" /><path d="M58,847.2891 L58,874.2891 M45,855.2891 L71,855.2891 M58,874.2891 L45,889.2891 M58,874.2891 L71,889.2891 " fill="none" style="stroke:#191919;stroke-width:0.5;" /><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="95" x="186.5" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="193.5" y="69.9951">InvestSuite</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="95" x="186.5" y="814.4922" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="193.5" y="834.4873">InvestSuite</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="142" x="491" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="498" y="69.9951">Client Middleware</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="142" x="491" y="814.4922" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="498" y="834.4873">Client Middleware</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="139" x="643" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="650" y="69.9951">Broker/Custodian</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="139" x="643" y="814.4922" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="650" y="834.4873">Broker/Custodian</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="168" x="792" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="799" y="69.9951">Core Banking System</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="168" x="792" y="814.4922" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="799" y="834.4873">Core Banking System</text><path d="M13.5,98.2969 L76,98.2969 L76,105.4297 L66,115.4297 L10,115.4297 L10,101.7969 A3.5,3.5 0 0 1 13.5,98.2969 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="90.2031" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="633" x="10" y="98.2969" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="25" y="111.3638">alt</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="115" x="91" y="110.5073">[InvestSuite App]</text><polygon fill="#191919" points="222,132.5625,232,136.5625,222,140.5625,226,136.5625" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="58" x2="228" y1="136.5625" y2="136.5625" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="65" y="131.4966">1a. Request withdrawal</text><line style="stroke:#393939;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="643" y1="145.5625" y2="145.5625" /><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="85" x="15" y="155.7729">[Middleware]</text><polygon fill="#191919" points="245,176.5,235,180.5,245,184.5,241,180.5" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="239" x2="561" y1="180.5" y2="180.5" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="251" y="175.4341">1b. Request withdrawal</text><line style="stroke:#191919;stroke-width:1.0;" x1="234" x2="276" y1="216.6328" y2="216.6328" /><line style="stroke:#191919;stroke-width:1.0;" x1="276" x2="276" y1="216.6328" y2="229.6328" /><line style="stroke:#191919;stroke-width:1.0;" x1="235" x2="276" y1="229.6328" y2="229.6328" /><polygon fill="#191919" points="245,225.6328,235,229.6328,245,233.6328,241,229.6328" style="stroke:#191919;stroke-width:1.0;" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="241" y="211.5669">2. Trigger Optimizer (asynchronously)</text><path d="M13.5,244.6328 L82,244.6328 L82,251.7656 L72,261.7656 L10,261.7656 L10,248.1328 A3.5,3.5 0 0 1 13.5,244.6328 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="46.2656" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="382" x="10" y="244.6328" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="25" y="257.6997">opt</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="290" x="97" y="256.8433">[if Advisory mandate and insufficient cash]</text><polygon fill="#191919" points="222,278.8984,232,282.8984,222,286.8984,226,282.8984" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="58" x2="228" y1="282.8984" y2="282.8984" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="152" x="65" y="277.8325">3. Confirm Optimization</text><polygon fill="#191919" points="550,345.2969,560,349.2969,550,353.2969,554,349.2969" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="234" x2="556" y1="349.2969" y2="349.2969" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="241" y="313.9653">4. portfolio.withdrawal event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="304" x="241" y="329.0981">(NOTE this actually happens in parallel with #2)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="241" y="344.231">Contains divest_amount</text><polygon fill="#191919" points="864,374.4297,874,378.4297,864,382.4297,868,378.4297" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="562" x2="870" y1="378.4297" y2="378.4297" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="569" y="373.3638">5. Get available cash in Portfolio</text><path d="M13.5,393.4297 L76,393.4297 L76,400.5625 L66,410.5625 L10,410.5625 L10,396.9297 A3.5,3.5 0 0 1 13.5,393.4297 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="405.0625" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="960" x="10" y="393.4297" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="25" y="406.4966">alt</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="292" x="91" y="405.6401">[Sufficient Cash (divest_amount &lt;= cash&gt;)]</text><polygon fill="#191919" points="864,427.6953,874,431.6953,864,435.6953,868,431.6953" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="562" x2="870" y1="431.6953" y2="431.6953" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="569" y="426.6294">5a. Execute cash transfer</text><polygon fill="#191919" points="245,517.3594,235,521.3594,245,525.3594,241,521.3594" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="239" x2="561" y1="521.3594" y2="521.3594" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="251" y="455.7622">5b. Create cash transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="251" y="470.895">POST /portfolios/{id}/transaction with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="251" y="486.0278">- Type CASH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="251" y="501.1606">- Status SETTLED</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="251" y="516.2935">- Quantity &lt;0</text><polygon fill="#191919" points="245,576.7578,235,580.7578,245,584.7578,241,580.7578" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="239" x2="561" y1="580.7578" y2="580.7578" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="251" y="545.4263">5c. Set the divest_amount to 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="251" y="560.5591">PATCH /portfolios with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="251" y="575.6919">- divest_amount 0</text><polygon fill="#191919" points="245,621.0234,235,625.0234,245,629.0234,241,625.0234" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="239" x2="561" y1="625.0234" y2="625.0234" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="251" y="604.8247">5d. Update Portfolio holdings</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="251" y="619.9575">PATCH /portfolios</text><polygon fill="#191919" points="245,650.1563,235,654.1563,245,658.1563,241,654.1563" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="239" x2="561" y1="654.1563" y2="654.1563" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="251" y="649.0903">5e. POST /events/withdraw</text><polygon fill="#191919" points="69,679.2891,59,683.2891,69,687.2891,65,683.2891" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="63" x2="233" y1="683.2891" y2="683.2891" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="75" y="678.2231">5f. Notification</text><line style="stroke:#393939;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="970" y1="692.2891" y2="692.2891" /><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="125" x="15" y="702.4995">[Insufficient Cash]</text><line style="stroke:#191919;stroke-width:1.0;" x1="562" x2="604" y1="712.0938" y2="712.0938" /><line style="stroke:#191919;stroke-width:1.0;" x1="604" x2="604" y1="712.0938" y2="725.0938" /><line style="stroke:#191919;stroke-width:1.0;" x1="563" x2="604" y1="725.0938" y2="725.0938" /><polygon fill="#191919" points="573,721.0938,563,725.0938,573,729.0938,569,725.0938" style="stroke:#191919;stroke-width:1.0;" /><path d="M567,741.5938 L567,789.5938 A3.5,3.5 0 0 0 570.5,793.0938 L955.5,793.0938 A3.5,3.5 0 0 0 959,789.5938 L959,748.0938 L949,738.0938 L570.5,738.0938 A3.5,3.5 0 0 0 567,741.5938 " fill="#E5E5E5" style="stroke:#181818;stroke-width:1.5;" /><path d="M949,738.0938 L949,746.3438 A1.75,1.75 0 0 0 950.75,748.0938 L959,748.0938 L949,738.0938 " fill="#E5E5E5" style="stroke:#181818;stroke-width:1.5;" /><text fill="#191919" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="573" y="755.1606">6. The withdrawal will be handled at a later time,</text><text fill="#191919" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299" x="573" y="770.2935">by the rebalancing process or the process that</text><text fill="#191919" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="371" x="573" y="785.4263">handles executed or settled transactions from the broker.</text></g></svg></p>
<h4 id="broker-integration-by-the-client-batch-process">Broker integration by the Client (Batch process)<a class="headerlink" href="#broker-integration-by-the-client-batch-process" title="Permanent link">&para;</a></h4>
<ol>
<li>A withdrawal is triggered:<ol>
<li>Either by the <strong>Customer</strong>, through the InvestSuite app. The app sets the <code>divest_amount</code> on the Portfolio object.</li>
<li>Either by the <strong>Client Middleware</strong>, by setting the <code>divest_amount</code> on the Portfolio (see <a href="../../concepts/portfolios/#set-divest-amount">here</a>).</li>
</ol>
</li>
<li><strong>InvestSuite</strong> asynchronously runs Optimizer, resulting in an Optimization which, during the next rebalancing, will free up cash.</li>
<li>In case of an advisory mandate and insufficient cash, the <strong>Customer</strong> confirms the Optimization. The confirmation is registered in the <code>owner_choice</code> field of the Optimization object.</li>
<li>In a batch process, the <strong>Client Middleware</strong> gets all portfolios with pending withdrawals (see <a href="../../concepts/portfolios/#get-portfolios-with-pending-withdrawals">here</a>).</li>
<li>If there is sufficient cash in the Portfolio (get this from the Core Banking System or from the Portfolio object):<ol>
<li>The <strong>Client Middleware</strong> instructs the <strong>Core Banking System</strong> to execute the cash transfer.</li>
<li>The <strong>Client Middleware</strong> creates a Transaction, type CASH, status SETTLED, and a negative quantity (see <a href="../../concepts/transactions/#withdrawal">here</a>).</li>
<li>The <strong>Client Middleware</strong> sets the <code>divest_amount</code> to 0, indicating there is no more cash to divest (see <a href="../../concepts/portfolios/#set-divest-amount">here</a>).</li>
<li>The <strong>Client Middleware</strong> updates the Portfolio Holdings with decreased cash (see <a href="../../concepts/portfolios/#holdings">here</a>).</li>
<li>The <strong>Client Middleware</strong> informs InvestSuite that the withdrawal has executed by calling <code>POST /events/withdraw/</code> (see <a href="../../concepts/events/#withdrawal-executed-event">here</a>).</li>
<li><strong>InvestSuite</strong> sends a notification to the Customer.</li>
</ol>
</li>
<li>If not, the withdrawal will be handled by the <strong>Client Middleware</strong> at a later time, during the next batch job run, by the rebalancing process or the process that handles executed or settled transactions from the broker. See the <a href="todo.md">Example Middleware Design</a>.</li>
</ol>
<p><svg contentStyleType="text/css" preserveAspectRatio="none" style="background:#F9F9F9" version="1.1" viewBox="0 0 933 927" width="100%" zoomAndPan="magnify" class="class1,class2" alt="uml diagram" title=""><defs /><g><rect fill="none" height="90.2031" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="570" x="20" y="98.2969" /><rect fill="none" height="46.2656" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="382" x="20" y="244.6328" /><rect fill="none" height="524.7266" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="917" x="10" y="304.8984" /><rect fill="none" height="405.0625" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="897" x="20" y="417.5625" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="68" x2="68" y1="81.2969" y2="846.625" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="242.5" x2="242.5" y1="81.2969" y2="846.625" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="509" x2="509" y1="81.2969" y2="846.625" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="659" x2="659" y1="81.2969" y2="846.625" /><line style="stroke:#393939;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="823" x2="823" y1="81.2969" y2="846.625" /><text fill="#191919" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="30" y="77.9951">Customer</text><ellipse cx="68" cy="13.5" fill="#191919" rx="8" ry="8" style="stroke:#191919;stroke-width:0.5;" /><path d="M68,21.5 L68,48.5 M55,29.5 L81,29.5 M68,48.5 L55,63.5 M68,48.5 L81,63.5 " fill="none" style="stroke:#191919;stroke-width:0.5;" /><text fill="#191919" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="30" y="858.6201">Customer</text><ellipse cx="68" cy="870.4219" fill="#191919" rx="8" ry="8" style="stroke:#191919;stroke-width:0.5;" /><path d="M68,878.4219 L68,905.4219 M55,886.4219 L81,886.4219 M68,905.4219 L55,920.4219 M68,905.4219 L81,920.4219 " fill="none" style="stroke:#191919;stroke-width:0.5;" /><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="95" x="195.5" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="202.5" y="69.9951">InvestSuite</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="95" x="195.5" y="845.625" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="202.5" y="865.6201">InvestSuite</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="142" x="438" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="445" y="69.9951">Client Middleware</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="142" x="438" y="845.625" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="128" x="445" y="865.6201">Client Middleware</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="139" x="590" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="597" y="69.9951">Broker/Custodian</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="139" x="590" y="845.625" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="125" x="597" y="865.6201">Broker/Custodian</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="168" x="739" y="50" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="746" y="69.9951">Core Banking System</text><rect fill="#E55756" height="30.2969" rx="3.5" ry="3.5" style="stroke:#191919;stroke-width:1.5;" width="168" x="739" y="845.625" /><text fill="#F9F9F9" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="154" x="746" y="865.6201">Core Banking System</text><path d="M23.5,98.2969 L86,98.2969 L86,105.4297 L76,115.4297 L20,115.4297 L20,101.7969 A3.5,3.5 0 0 1 23.5,98.2969 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="90.2031" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="570" x="20" y="98.2969" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="35" y="111.3638">alt</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="115" x="101" y="110.5073">[InvestSuite App]</text><polygon fill="#191919" points="231,132.5625,241,136.5625,231,140.5625,235,136.5625" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="68" x2="237" y1="136.5625" y2="136.5625" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="75" y="131.4966">1a. Request withdrawal</text><line style="stroke:#393939;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="590" y1="145.5625" y2="145.5625" /><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="85" x="25" y="155.7729">[Middleware]</text><polygon fill="#191919" points="254,176.5,244,180.5,254,184.5,250,180.5" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="248" x2="508" y1="180.5" y2="180.5" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="260" y="175.4341">1b. Request withdrawal</text><line style="stroke:#191919;stroke-width:1.0;" x1="243" x2="285" y1="216.6328" y2="216.6328" /><line style="stroke:#191919;stroke-width:1.0;" x1="285" x2="285" y1="216.6328" y2="229.6328" /><line style="stroke:#191919;stroke-width:1.0;" x1="244" x2="285" y1="229.6328" y2="229.6328" /><polygon fill="#191919" points="254,225.6328,244,229.6328,254,233.6328,250,229.6328" style="stroke:#191919;stroke-width:1.0;" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="250" y="211.5669">2. Trigger Optimizer (asynchronously)</text><path d="M23.5,244.6328 L92,244.6328 L92,251.7656 L82,261.7656 L20,261.7656 L20,248.1328 A3.5,3.5 0 0 1 23.5,244.6328 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="46.2656" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="382" x="20" y="244.6328" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="27" x="35" y="257.6997">opt</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="290" x="107" y="256.8433">[if Advisory mandate and insufficient cash]</text><polygon fill="#191919" points="231,278.8984,241,282.8984,231,286.8984,235,282.8984" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="68" x2="237" y1="282.8984" y2="282.8984" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="75" y="277.8325">3. Confirm sell</text><path d="M13.5,304.8984 L88,304.8984 L88,312.0313 L78,322.0313 L10,322.0313 L10,308.3984 A3.5,3.5 0 0 1 13.5,304.8984 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="524.7266" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="917" x="10" y="304.8984" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="25" y="317.9653">loop</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="189" x="103" y="317.1089">[Batch process (eg. nightly)]</text><polygon fill="#191919" points="254,369.4297,244,373.4297,254,377.4297,250,373.4297" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="248" x2="508" y1="373.4297" y2="373.4297" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134" x="260" y="338.0981">4. Get portfolios with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="260" y="353.231">pending withdrawals</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="260" y="368.3638">GET /portfolios?query=...</text><polygon fill="#191919" points="811,398.5625,821,402.5625,811,406.5625,815,402.5625" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="509" x2="817" y1="402.5625" y2="402.5625" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="206" x="516" y="397.4966">5. Get available cash in Portfolio</text><path d="M23.5,417.5625 L86,417.5625 L86,424.6953 L76,434.6953 L20,434.6953 L20,421.0625 A3.5,3.5 0 0 1 23.5,417.5625 " fill="#EEEEEE" style="stroke:#393939;stroke-width:1.5;" /><rect fill="none" height="405.0625" rx="3.5" ry="3.5" style="stroke:#393939;stroke-width:1.0;" width="897" x="20" y="417.5625" /><text fill="#191919" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="35" y="430.6294">alt</text><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="292" x="101" y="429.7729">[Sufficient Cash (divest_amount &lt;= cash&gt;)]</text><polygon fill="#191919" points="811,451.8281,821,455.8281,811,459.8281,815,455.8281" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="509" x2="817" y1="455.8281" y2="455.8281" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="516" y="450.7622">5a. Execute cash transfer</text><polygon fill="#191919" points="254,541.4922,244,545.4922,254,549.4922,250,545.4922" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="248" x2="508" y1="545.4922" y2="545.4922" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="260" y="479.895">5b. Create cash transaction</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="260" y="495.0278">POST /portfolios/{id}/transaction with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="260" y="510.1606">- Type CASH</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="260" y="525.2935">- Status SETTLED</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="86" x="260" y="540.4263">- Quantity &lt;0</text><polygon fill="#191919" points="254,600.8906,244,604.8906,254,608.8906,250,604.8906" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="248" x2="508" y1="604.8906" y2="604.8906" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="198" x="260" y="569.5591">5c. Set the divest_amount to 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="260" y="584.6919">PATCH /portfolios with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="260" y="599.8247">- divest_amount 0</text><polygon fill="#191919" points="254,645.1563,244,649.1563,254,653.1563,250,649.1563" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="248" x2="508" y1="649.1563" y2="649.1563" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="260" y="628.9575">5d. Update Portfolio holdings</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="111" x="260" y="644.0903">PATCH /portfolios</text><polygon fill="#191919" points="254,674.2891,244,678.2891,254,682.2891,250,678.2891" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="248" x2="508" y1="678.2891" y2="678.2891" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="173" x="260" y="673.2231">5e. POST /events/withdraw</text><polygon fill="#191919" points="79,703.4219,69,707.4219,79,711.4219,75,707.4219" style="stroke:#191919;stroke-width:1.0;" /><line style="stroke:#191919;stroke-width:1.0;" x1="73" x2="242" y1="707.4219" y2="707.4219" /><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="85" y="702.356">5f. Notification</text><line style="stroke:#393939;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="917" y1="716.4219" y2="716.4219" /><text fill="#393939" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="125" x="25" y="726.6323">[Insufficient Cash]</text><line style="stroke:#191919;stroke-width:1.0;" x1="509" x2="551" y1="736.2266" y2="736.2266" /><line style="stroke:#191919;stroke-width:1.0;" x1="551" x2="551" y1="736.2266" y2="749.2266" /><line style="stroke:#191919;stroke-width:1.0;" x1="510" x2="551" y1="749.2266" y2="749.2266" /><polygon fill="#191919" points="520,745.2266,510,749.2266,520,753.2266,516,749.2266" style="stroke:#191919;stroke-width:1.0;" /><path d="M514,765.7266 L514,813.7266 A3.5,3.5 0 0 0 517.5,817.2266 L902.5,817.2266 A3.5,3.5 0 0 0 906,813.7266 L906,772.2266 L896,762.2266 L517.5,762.2266 A3.5,3.5 0 0 0 514,765.7266 " fill="#E5E5E5" style="stroke:#181818;stroke-width:1.5;" /><path d="M896,762.2266 L896,770.4766 A1.75,1.75 0 0 0 897.75,772.2266 L906,772.2266 L896,762.2266 " fill="#E5E5E5" style="stroke:#181818;stroke-width:1.5;" /><text fill="#191919" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="312" x="520" y="779.2935">6. The withdrawal will be handled at a later time,</text><text fill="#191919" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="299" x="520" y="794.4263">by the rebalancing process or the process that</text><text fill="#191919" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="371" x="520" y="809.5591">handles executed or settled transactions from the broker.</text></g></svg></p>
<h3 id="self-investor">Self Investor<a class="headerlink" href="#self-investor" title="Permanent link">&para;</a></h3>
<h4 id="broker-integration-by-investsuite_2">Broker integration by InvestSuite<a class="headerlink" href="#broker-integration-by-investsuite_2" title="Permanent link">&para;</a></h4>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>We assume there is an integration between the Broker/Custodian and the Core Banking System (eg. through end-of-day files), which is master of the <code>counter_account</code> and handles the corresponding cash transfers.</p>
</div>
<ol>
<li>The <strong>Client</strong> issues a withdrawal in the app.</li>
<li><strong>InvestSuite</strong> moves the cash at the broker from the customer's subaccount to the bank's home account. InvestSuite will manage keeping the Transactions and Portfolio Holdings up to date (asynchronously). When this process completes, <strong>InvestSuite</strong> sends a notification to the Customer.</li>
<li>The <strong>Core Banking System</strong> transfers the cash to the customer's <code>counter_account</code>.</li>
</ol>
    

              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../onboarding/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Onboarding (process)" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Onboarding (process)
            </div>
          </div>
        </a>
      
      
        
        <a href="../suitability_profiler/" class="md-footer__link md-footer__link--next" aria-label="Next: Suitability profiler" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Suitability profiler
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 InvestSuite
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://www.investsuite.com/" target="_blank" rel="noopener" title="www.investsuite.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M352 256c0 22.2-1.2 43.6-3.3 64H163.3c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64h185.4c2.2 20.4 3.3 41.8 3.3 64zm28.8-64h123.1c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64H380.8c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64zm112.6-32H376.7c-10-63.9-29.8-117.4-55.3-151.6 78.3 20.7 142 77.5 171.9 151.6zm-149.1 0H167.7c6.1-36.4 15.5-68.6 27-94.7 10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5 11.6 26 21 58.2 27 94.7zm-209 0H18.6c30-74.1 93.6-130.9 172-151.6-25.5 34.2-45.3 87.7-55.3 151.6zM8.1 192h123.1c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64H8.1C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64zm186.6 254.6c-11.6-26-20.9-58.2-27-94.6h176.6c-6.1 36.4-15.5 68.6-27 94.6-10.5 23.6-22.2 40.7-33.5 51.5-11.2 10.7-20.5 13.9-27.8 13.9s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6-78.4-20.7-142-77.5-172-151.6h116.7zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6 25.5-34.2 45.2-87.7 55.3-151.6h116.6z"/></svg>
    </a>
  
    
    
    <a href="mailto:api@investsuite.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://twitter.com/investsuite" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://www.linkedin.com/company/investsuite" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://instagram.com/investsuite" target="_blank" rel="noopener" title="instagram.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  </body>
</html>